<div class="container mt-4 px-4 px-lg-5">
  <div class="row">
    <div class="col-12 mb-4 text-center">
      <h1 class="display-5">Carga manual de facturas</h1>
      <p class="lead">Sube un PDF para procesarlo y extraer sus datos</p>
    </div>
  </div>

  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow">
        <div class="card-header header-primary">
          <h5 class="card-title mb-0">Formulario de carga</h5>
        </div>
        
        <div class="card-body">
          <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()">
            <!-- Selector de archivo -->
            <div class="mb-4">
              <label for="file" class="form-label">Archivo PDF *</label>
              <div class="input-group">
                <input type="file" class="form-control" id="file" accept=".pdf" (change)="onFileSelected($event)" [disabled]="loading">
                <button class="btn btn-outline-primary" type="button" onclick="document.getElementById('file').click()">
                  <i class="bi bi-upload"></i> Examinar
                </button>
              </div>
              <div *ngIf="fileName" class="mt-2 text-primary">
                <i class="bi bi-file-earmark-pdf"></i> {{ fileName }}
              </div>
            </div>
            
            <!-- Campos adicionales -->
            <div class="mb-3">
              <label for="sender" class="form-label">Remitente (opcional)</label>
              <input type="text" class="form-control" id="sender" formControlName="sender" placeholder="Correo o nombre del remitente" [disabled]="loading">
            </div>
            
            <div class="mb-4">
              <label for="date" class="form-label">Fecha del documento (opcional)</label>
              <input type="date" class="form-control" id="date" formControlName="date" [disabled]="loading">
            </div>
            
            <!-- Botones de acción -->
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-success" [disabled]="loading || !selectedFile">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                <i *ngIf="!loading" class="bi bi-cloud-upload"></i>
                Procesar factura
              </button>
              <button type="button" class="btn btn-outline-primary" (click)="goToDashboard()">
                <i class="bi bi-arrow-left"></i> Volver al dashboard
              </button>
            </div>
          </form>
          
          <!-- Mensajes de error -->
          <div *ngIf="error" class="alert alert-danger mt-4">
            <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ error }}
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Resultados del procesamiento -->
  <div *ngIf="result" class="row mt-4 justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow">
        <div class="card-header header-secondary">
          <h5 class="card-title mb-0">Resultado del procesamiento</h5>
        </div>
        <div class="card-body">
          <div class="alert" [ngClass]="{'alert-success': result.success, 'alert-danger': !result.success}">
            {{ result.message }}
          </div>
          
          <!-- Detalles de la factura procesada -->
          <div *ngIf="result && result.success && result.invoices && result.invoices.length > 0" class="mt-4">
            <h6 class="mb-3">Datos extraídos:</h6>
            <div class="table-responsive">
              <table class="table table-bordered">
                <tr>
                  <th>Fecha</th>
                  <td>{{ result.invoices[0].fecha ? (result.invoices[0].fecha | date:'dd/MM/yyyy') : 'No detectada' }}</td>
                </tr>
                <tr>
                  <th>RUC Emisor</th>
                  <td>{{ result.invoices[0].ruc_emisor || 'No detectado' }}</td>
                </tr>
                <tr>
                  <th>Nombre Emisor</th>
                  <td>{{ result.invoices[0].nombre_emisor || 'No detectado' }}</td>
                </tr>
                <tr>
                  <th>Nro. Factura</th>
                  <td>{{ result.invoices[0].numero_factura || 'No detectado' }}</td>
                </tr>
                <tr>
                  <th>Monto Total</th>
                  <td>{{ result.invoices[0].monto_total ? (result.invoices[0].monto_total | currency:'':'symbol':'1.2-2') : 'No detectado' }}</td>
                </tr>
                <tr>
                  <th>IVA</th>
                  <td>{{ result.invoices[0].iva ? (result.invoices[0].iva | currency:'':'symbol':'1.2-2') : 'No detectado' }}</td>
                </tr>
              </table>
            </div>
            
            <div class="d-grid gap-2 mt-3">
              <button class="btn btn-outline-primary" (click)="resetForm()">
                <i class="bi bi-arrow-repeat"></i> Procesar otra factura
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
